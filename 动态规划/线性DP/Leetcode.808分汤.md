### 原题链接 -- [[808. 分汤](https://leetcode.cn/problems/soup-servings/)]

### 题目概述：
Tag : 「动态规划」、「概率」

![image](https://user-images.githubusercontent.com/99656524/203091064-54bc9434-0a29-4ea4-9db4-239e543ac1c2.png)

### 解法一：记忆化搜索 + 数学（概率论）
十分困难的中等题，直接CV了，答案是找的，以下是我的理解

题目各个选项选择的概率是 $1/4$ ，我们要将两种 $n$ $ml$ 的汤根据这四种选项的方案将两种汤分完。根据第一种方案如果A汤的体积 < 100 ml，则A先分完的概率是1，以此类推根据第二种方案中若A汤的体积 < 75ml，则A先分完的概率是1，
反之若B汤体积 < 25 ml 并且 A汤的体积 > 75 ml，则A汤先分完的概率是0，第三种方案中若A和B汤的体积同时小于 < 50ml时则代表同时分完，同时分完的概率为1，根据题目要求要将其除以2，第四种方案则
是第二种的反向选项，若两种汤并不在100ml范围以内，我们就要通过概率枚举上面这四种方案进行状态转移。

本题的另外一个难点是利用特判来减少数值过大的时候的运算。本题给了一个数值范围在 $1e-5$ 范围内有效是这题的一个关键突破点，这说明答案在某个数值之后是收敛于某个值的。根据收敛定义
若 $|x - p| < e$ 代表x收敛于p，e是一个收敛半径。由此我们也可以得到，最后趋近的一定是某个概率，我们可以算出A，B两种汤分完的数学期望：

$$
E(A) = sum(np) = 100/4 + 75/4 + 50 / 4 + 25 /4 = 62.5
$$

$$
E(B) = sum(np) = 25/4 + 50/4 + 75/5 = 37.5
$$

因为 $E(A) > E(B)$ ，因此当数值很大的时候，A先被分完的概率趋近于1，因此我们通过收敛定义可以得出当 $n>=5000$ 的时候A一定是被分完的。

python代码：
```py
class Solution:
    def soupServings(self, n: int) -> float:
        if n >= 5000:
            return 1.
        
        @cache
        def dfs(a, b):
            if a <= 0 and b <= 0:
                return 0.5
            elif a <= 0:
                return 1.
            elif b <= 0:
                return 0.
            else:
                return 0.25 * dfs(a - 100, b) + 0.25 * dfs(a - 75, b - 25) + 0.25 * dfs(a - 50, b - 50) + 0.25 * dfs(a - 25, b - 75)

        # # 推算临界值
        # for i in range(100, 1000000):
        #     if 1 - dfs(i, i) <= 1e-5:
        #         print(i)
        #         break
        
        return dfs(n, n)
```
* 时间复杂度： $O(n^2)$ ,当 $n >= 5000$ 时，时间复杂度为常数级别
* 空间复杂度： $O(n^2)$ ,当 $n >= 5000$ 时，空间复杂度为常数级别
